#!/bin/bash

set -e

# Apaga a pasta android se ela jÃ¡ existir
if [ -d android ]; then
echo "ğŸ—‘ï¸ Pasta 'android' jÃ¡ existe. Removendo..."
rm -rf android
echo "âœ… Pasta 'android' removida."
fi

# Apaga a pasta android se ela jÃ¡ existir
if [ -d ios ]; then
echo "ğŸ—‘ï¸ Pasta 'ios' jÃ¡ existe. Removendo..."
rm -rf ios
echo "âœ… Pasta 'ios' removida."
fi

echo "ğŸš§ Iniciando prebuild..."
npx expo prebuild

echo "ğŸ—ï¸ Buildando release Android..."
cd android
./gradlew assembleRelease
cd ..

# Renomeia o APK final
APK_PATH="android/app/build/outputs/apk/release/app-release.apk"
DEST_APK="aoba.apk"
if [ -f "${APK_PATH}" ]; then
cp "${APK_PATH}" ~/Downloads/"${DEST_APK}"
echo "âœ… APK renomeado para ${DEST_APK}"
else
echo "âŒ NÃ£o foi possÃ­vel encontrar o APK em ${APK_PATH}"
exit 1
fi

echo "ğŸ‰ Build finalizado com sucesso! APK: ${DEST_APK}, branch: build-${nome}"
